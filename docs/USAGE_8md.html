<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MetroCollect: MetroCollect Usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MetroCollect
   &#160;<span id="projectnumber">2.3.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('USAGE_8md.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="namespaceMetroCollect.html">MetroCollect</a> Usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Contents</h2>
<ul>
<li><a href="#metrocollect-usage">MetroCollect Usage</a><ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#metrics">Metrics</a><ul>
<li><a href="#cpu-metrics">CPU Metrics</a></li>
<li><a href="#memory-metrics">Memory metrics</a></li>
<li><a href="#network-metrics">Network metrics</a></li>
<li><a href="#ethtool-metrics">Ethtool metrics</a></li>
</ul>
</li>
<li><a href="#standalone-interfaces">Standalone interfaces</a><ul>
<li><a href="#metrocollectvalues">MetroCollectValues</a></li>
<li><a href="#metrocollectstats">MetroCollectStats</a></li>
<li><a href="#metrocollectfiles">MetroCollectFiles</a></li>
</ul>
</li>
<li><a href="#snap-configuration">Snap Configuration</a><ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#parameters">Parameters</a></li>
<li><a href="#metrics-1">Metrics</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>Metrics</h2>
<p><a class="el" href="namespaceMetroCollect.html">MetroCollect</a> gathers metrics from different sources:</p><ul>
<li>CPU metrics from <code>/proc/stat</code></li>
<li>Memory metrics from <code>/proc/meminfo</code></li>
<li>Network metrics from <code>/proc/net/dev</code></li>
<li>Addtional network metrics with Ethtool</li>
</ul>
<p>Those metrics are organized hierarchically. For instance, <code>/cfm/memory/cached</code> represents the amount of cached memory on the system, while <code>cfm/network/eth0/rx/bytes</code> represents the number of bytes received by <code>eth0</code>.</p>
<p>Most metric have a unit attached to it, and are expressed in units per second.</p>
<h3>CPU Metrics</h3>
<p>CPU metrics are read from the <code>/proc/stat</code> file, you may refer to the relevant man page of your system to have a thorough description.</p>
<p>As a summary, there are three types of CPU metrics:</p><ul>
<li>for each CPU core, proportion of time spent in differents CPU states (user, system, nice, idle, etc.)</li>
<li>aggregated proportion of time spent in differents CPU states</li>
<li>other CPU metrics: number of interrupts, soft interrupts, spawned processed, running and blocked processes, etc.</li>
</ul>
<h3>Memory metrics</h3>
<p>Memory metrics are read from the <code>/proc/memory</code> file, you may refer to the relevant man page of your system to have a thorough description.</p>
<h3>Network metrics</h3>
<p>Network metrics are read from the <code>/proc/net/dev</code> file, you may refer to the relevant man page of your system to have a thorough description.</p>
<p>For each interface (either up or down), the number of bytes, packets and various errors are collected, for both reception ("rx") and transmission ("tx").</p>
<h3>Ethtool metrics</h3>
<p>These are the same metrics provided by the <code>ethtool -S $iface</code> for each network interface <code>$iface</code>. It provides very detailled information about each interface, but these information depend on the interface's driver. you may refer to the driver documentation for more details.</p>
<p><a class="el" href="namespaceMetroCollect.html">MetroCollect</a> supports all drivers supported by <code>ethtool</code>, and it is optimized for <code>ixgbe</code>, <code>igb</code> and <code>i40e</code>.</p>
<p>When a number appears in a metric name, it is moved at the end of it. For instance: </p><div class="fragment"><div class="line">$ ethtool -S eth0</div><div class="line">rx_queue_0_packets: 0</div><div class="line">rx_queue_0_bytes: 0</div><div class="line">rx_queue_1_packets: 0</div><div class="line">rx_queue_1_bytes: 0</div><div class="line">...</div></div><!-- fragment --><p> becomes </p><div class="fragment"><div class="line">/ethtool/ixgbe/eth0/rx_queue_i_packets/0    0</div><div class="line">/ethtool/ixgbe/eth0/rx_queue_i_bytes/0      0</div><div class="line">/ethtool/ixgbe/eth0/rx_queue_i_packets/1    0</div><div class="line">/ethtool/ixgbe/eth0/rx_queue_i_bytes/1      0</div><div class="line">...</div></div><!-- fragment --><h2>Standalone interfaces</h2>
<h3>MetroCollectValues</h3>
<p>This program collects all available metrics and prints them on the standard output. For each metric, it shows values read from the kernel at some time, values read some time later, and the computed variation. That is because most kernel values are counters that can only increase; for example the number of bytes sent by eth0 or the amount of interrupts serviced.</p>
<p>MetroCollectValues can take up to <b>two arguments</b>:</p><ul>
<li>the sampling interval in milliseconds, that is the duration to wait between two readings of kernel values. Default is 100 milliseconds</li>
<li>how many times to report metrics. Default is 0, which means unlimited time</li>
</ul>
<p>For example, <code>./MetroCollectValues 500 10</code> will read kernel values and print them every 500 milliseconds, and it will do so 10 times. The program will thus run for 5 seconds.</p>
<h3><a class="el" href="structMetroCollectStats.html" title="Small struct to implement MetricsController delegate. ">MetroCollectStats</a></h3>
<p>This program collects all available metrics, compute statistics on a moving window and prints them on the standard output. For each metric, it shows the minimum, maximum, average and standard deviation of its variation.</p>
<p>MetroCollectValues can take up to <b>four arguments</b>:</p><ul>
<li>the sampling interval in milliseconds, that is the duration to wait between two readings of kernel values. Default is 100 milliseconds</li>
<li>the length of the moving window in number of samples. Default is 10 (statisctics are computed every 10 samples)</li>
<li>the overlap of the moving window in number of samples, it must be less than the length of the window. Default is 0 (no overlap)</li>
<li>how many times to report metrics. Default is 0, which means unlimited time</li>
</ul>
<p>By default, statsics are thus computed and printed every 1 second.</p>
<p>For example, <code>./MetroCollectStats 50 5 0 4</code> will read kernel values every 50 milliseconds, and compute and print stats every 5 samples (that is every 250 milliseconds), and it will do so 4 times. The program will thus run for 1 seconds.</p>
<h3>MetroCollectFiles</h3>
<p>This program collects all available metrics and write them to a file.</p>
<p>MetroCollectValues can take up to <b>three arguments</b>:</p><ul>
<li>the sampling interval in milliseconds, that is the duration to wait between two readings of kernel values. Default is 100 milliseconds</li>
<li>how many times to report metrics. Default is 0, which means unlimited time</li>
<li>path of the file to write to. Default is <code>./output.csv</code></li>
</ul>
<p>For example, <code>./MetroCollectFile 0 20 maxspeed.csv</code> will read kernel values continuously (no delay between readings) 20 times, and write the variation to he file <code>./maxspeed.csv</code>.</p>
<h2>Snap Configuration</h2>
<h3>Configuration</h3>
<p>First set up the <a href="https://github.com/intelsdi-x/snap/blob/master/README.md#getting-started">Snap framework</a>.</p>
<p>The default configuration for a <a class="el" href="namespaceMetroCollect.html">MetroCollect</a> Snap task is the following: </p><div class="fragment"><div class="line">---</div><div class="line">  version: 1</div><div class="line">  schedule:</div><div class="line">    type: &quot;streaming&quot;</div><div class="line">  max-failures: 10</div><div class="line">  workflow:</div><div class="line">    collect:</div><div class="line">      metrics:</div><div class="line">        /cfm/*: {}</div><div class="line">      config:</div><div class="line">        /cfm:</div><div class="line">          SendValues: false</div><div class="line">          SendStats: true</div><div class="line">          SamplingInterval: 100</div><div class="line">          ProcessingWindowLength: 10</div><div class="line">          ProcessingWindowOverlap: 0</div><div class="line">          ConvertToUnitPerSecond: true</div><div class="line">          UnchangedMetricTimeout: 120</div><div class="line">          # MaxMetricsBuffer: 0</div><div class="line">          # MaxCollectDuration: 0</div><div class="line">      publish:</div><div class="line">#       ...</div></div><!-- fragment --><h3>Parameters</h3>
<p>The parameters are (default values are given <a href="#configuration">above</a>):</p><ul>
<li><code>SendValues</code> (type boolean): whether or not to send values to Snap</li>
<li><code>SendStats</code> (type boolean): whether or not to send statistics to Snap</li>
<li><code>SamplingInterval</code> (type int): delay in millisecond between two readings of the kernel values</li>
<li><code>ProcessingWindowLength</code> (type int): moving window length (in number of samples). It is used to compute statistics</li>
<li><code>ProcessingWindowOverlap</code> (type int): moving window overlap (in number of samples), it must be less than the length of the window. It is used to compute statistics</li>
<li><code>ConvertToUnitPerSecond</code> (type boolean): wether or not to convert values in units per second if relevant (if you prefer the number of bytes sent per second instead of bytes sent per 100 milliseconds)</li>
<li><code>UnchangedMetricTimeout</code> (type int): by default, for performance reasons, constant metrics are downsampled and thus not sent everytime to Snap. If the value changes it is sent immediatly. This parameter is the downsample factor: how many null variations to ignore before sending the value to Snap again. If it is 0, downsample will not take place, if it is -1 constant values will never be sent</li>
<li><code>MaxMetricsBuffer</code> (type int): maximum number of metrics to send to Snap at once</li>
<li><code>MaxCollectDuration</code> (type int): maximum waiting time (in seconds) before sending metrics to Snap</li>
</ul>
<p>By default, values will be read from the kernel every 100 milliseconds, compute stats every 10 samples (that is every 1 second) and send them to Snap. If a value has remained constant across 120 iterations (that is during 2 minutes), zeros will be sent to Snap.</p>
<h3>Metrics</h3>
<p>Collected metrics are described <a href="#metrics">above</a>.</p>
<p>For each metric, you can select which statistics you are interested in (shown below for the metric of aggegated CPU proportion of time spent in user mode, <b>note the use of wildcards</b>): </p><div class="fragment"><div class="line">/cfm/cpu/all/user/min/*: {}</div><div class="line">/cfm/cpu/all/user/max/*: {}</div><div class="line">/cfm/cpu/all/user/average/*: {}</div><div class="line">/cfm/cpu/all/user/stddev/*: {}</div></div><!-- fragment --><p>You can use wildcards to specify groups of metrics easily: </p><div class="fragment"><div class="line">/cfm/cpu/all/*: {}</div><div class="line">/cfm/memory/*: {}</div><div class="line">/cfm/network/eth0/*: {}</div><div class="line">...</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Nov 28 2018 15:05:17 for MetroCollect by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
